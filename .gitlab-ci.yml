image: nikolaik/python-nodejs:python3.6-nodejs12-stretch

stages:
  - test
  - deploy

test:
  stage: test
  script:
    # - pip install -r requirements.txt
    - pip install -r requirements-offline.txt
    - python -m unittest

production:
  stage: deploy
  before_script:
    - npm config set prefix /usr/local
    - npm install -g serverless
    - npm install --save serverless-python-requirements
    - npm install --save serverless-package-python-functions
  script:
    - serverless deploy --stage production --verbose
  environment: production
  only:
    refs:
      - master
